<validation_enforcement>
  <overview>
    Validation rules for documentation edits. Complete all validation steps before editing existing files.
  </overview>

  <severity_levels>
    <level name="CRITICAL">
      <description>Violations that result in task rejection</description>
      <violations>
        <item>Skipping redundancy check when editing existing files</item>
        <item>Creating duplicate content when similar content already exists</item>
        <item>Proceeding with edits without user approval after validation</item>
      </violations>
    </level>
    <level name="BLOCKING">
      <description>Issues that prevent progression until resolved</description>
      <violations>
        <item>Incomplete validation checklist</item>
        <item>Missing impact analysis for cross-references</item>
        <item>Not searching for term variations during discovery</item>
      </violations>
    </level>
    <level name="WARNING">
      <description>Issues that require correction but allow conditional progression</description>
      <violations>
        <item>Inconsistent terminology usage</item>
        <item>Missing bidirectional links</item>
        <item>Incomplete post-update verification</item>
      </violations>
    </level>
  </severity_levels>

  <validation_workflow>
    <phase name="discovery">
      <description>Find all existing related content before making changes</description>
      <steps>
        <step>Use codebase_search with the primary topic/feature name</step>
        <step>Search variations of key terms (e.g., "config" → "configuration", "setup", "settings")</step>
        <step>Read all discovered related content thoroughly</step>
        <step>Document locations with file paths and relevance</step>
      </steps>
    </phase>

    <phase name="analysis">
      <description>Determine how to proceed based on discovery</description>
      <decision_matrix>
        <scenario condition="Content exists and is complete">
          <action>STOP. Inform user with specific file location. Do not create duplicate.</action>
        </scenario>
        <scenario condition="Content exists but is incomplete">
          <action>Enhance existing content at its current location.</action>
        </scenario>
        <scenario condition="Content is scattered">
          <action>Propose consolidation plan to user before edits.</action>
        </scenario>
        <scenario condition="Content doesn't exist">
          <action>Document finding and proceed to implementation.</action>
        </scenario>
      </decision_matrix>
    </phase>

    <phase name="impact_assessment">
      <description>Identify all files affected by the change</description>
      <checks>
        <check>List internal links that reference this content</check>
        <check>Identify files needing updates if content moves</check>
        <check>Check hardcoded references in other docs, config files, code examples</check>
        <check>Plan redirect updates for docusaurus.config.ts if needed</check>
      </checks>
    </phase>

    <phase name="approval">
      <description>Get user confirmation before proceeding</description>
      <requirement>Use ask_followup_question to present validation findings</requirement>
      <include_in_report>
        <item>All discovered duplicate or related content with locations</item>
        <item>Impact analysis results</item>
        <item>Recommended approach</item>
        <item>List of affected files</item>
      </include_in_report>
    </phase>

    <phase name="implementation">
      <description>Apply changes only after approval</description>
      <steps>
        <step>If updating existing content, preserve valuable context</step>
        <step>If adding new content, link to related topics discovered earlier</step>
        <step>Update all affected cross-references</step>
        <step>Maintain consistent terminology</step>
      </steps>
    </phase>

    <phase name="verification">
      <description>Confirm changes maintain documentation integrity</description>
      <checks>
        <check>Re-run codebase_search to ensure no duplicates created</check>
        <check>Verify all cross-references still work</check>
        <check>Confirm terminology remains consistent</check>
      </checks>
    </phase>
  </validation_workflow>

  <validation_gates>
    <gate name="pre_edit">
      <description>Before any edits to existing files</description>
      <requirements>
        <requirement>Complete content discovery searches</requirement>
        <requirement>Read all discovered related content</requirement>
        <requirement>Document validation findings</requirement>
        <requirement>Get explicit user approval</requirement>
      </requirements>
    </gate>

    <gate name="duplication_prevention">
      <description>Prevents creation of duplicate content</description>
      <rules>
        <rule>If similar content exists, update existing location</rule>
        <rule>If content is scattered, propose consolidation</rule>
        <rule>Never create new content if it duplicates existing</rule>
      </rules>
    </gate>

    <gate name="value_filter">
      <description>Enforces value-first writing</description>
      <requirements>
        <requirement>Include "Why it matters" opener (1–3 sentences)</requirement>
        <requirement>Document decision points and trade-offs</requirement>
        <requirement>Remove UI narration that lacks decisions/implications</requirement>
        <requirement>Respect screenshot limits (≤1/section, ≤3/page)</requirement>
      </requirements>
    </gate>

    <gate name="consistency">
      <description>Ensures documentation remains consistent</description>
      <requirements>
        <requirement>Terminology matches existing usage</requirement>
        <requirement>Cross-references remain valid</requirement>
        <requirement>No contradictions with existing content</requirement>
      </requirements>
    </gate>
  </validation_gates>

  <approval_template>
    <description>Template for presenting validation findings to user</description>
    <format>
I've completed validation. Here are my findings:

**Content Discovery:**
- Searched for: [list search terms]
- Found existing content in: [list locations]

**Duplication Analysis:**
[Summary of existing content]

**Recommended Approach:**
[Specific recommendation]

**Affected Files:**
[Complete list]

Should I proceed with this approach?
    </format>
    <suggested_responses>
      <response>Yes, proceed with the recommended approach</response>
      <response>No, let me provide different instructions</response>
      <response>Show me the existing content first</response>
      <response>Consolidate the scattered content instead</response>
    </suggested_responses>
  </approval_template>

  <cross_references>
    <heading_policy>See 1_writing_style.xml for heading/ToC rules and enforcement</heading_policy>
    <screenshot_policy>See 2_docusaurus_conventions.xml for screenshot format and limits</screenshot_policy>
  </cross_references>
</validation_enforcement>
